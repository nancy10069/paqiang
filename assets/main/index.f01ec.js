window.__require=function t(e,i,s){function r(o,h){if(!i[o]){if(!e[o]){var c=o.split("/");if(c=c[c.length-1],!e[c]){var a="function"==typeof __require&&__require;if(!h&&a)return a(c,!0);if(n)return n(c,!0);throw new Error("Cannot find module '"+o+"'")}o=c}var d=i[o]={exports:{}};e[o][0].call(d.exports,function(t){return r(e[o][1][t]||t)},d,d.exports,t,e,i,s)}return i[o].exports}for(var n="function"==typeof __require&&__require,o=0;o<s.length;o++)r(s[o]);return r}({GM:[function(t,e){"use strict";cc._RF.push(e,"6a4888rC2xLfJjyyUa8/JaM","GM"),cc.Class({extends:cc.Component,properties:{endTitle:cc.Label,endContent:cc.Node,setup:cc.JsonAsset,tagSetup:cc.JsonAsset,holder:cc.Node,pfb:cc.Node,label:cc.Label,propHolder:cc.Node,turnText:cc.Label,choicePfb:cc.Node,choiceHolder:cc.Node,setupPage:cc.Node,endPage:cc.Node},end:function(){this.endPage.active=!0;for(var t=0;t<this.endTexts.length;t++){var e=cc.instantiate(this.pfb);this.endContent.addChild(e),e.setPosition(0,0),e.children[0].getComponent(cc.Label).string=this.endTexts[t]}this.endTitle.string=this.author+"\u5728"+this.cps[0]+"\u7684\u4e00\u751f"},restart:function(){this.endPage.active=!1,this.endTexts=[],this.setupPage.active=!0,this.clearHolder(this.holder),this.clearHolder(this.endContent),this.init();for(var t=0;t<this.events.length;t++)this.events[t].used=!1},strReplaceAll:function(t,e,i){if(void 0===t&&(t=" "),void 0===e&&(e="_"),i){var s=i.replace(t,e);return s.includes(t)&&(s=this.strReplaceAll(t,e,s)),s}},getRandomInt:function(t){var e=t;return e=Math.floor(e),Math.floor(Math.random()*e)},start:function(){this.basicWordTags=["\u5199\u4e86\u72d7\u8840","\u5199\u4e86\u5bab\u6597","\u5199\u4e86\u8d35\u4e71","\u5199\u4e86\u51f9","\u5199\u4e86\u751c\u997c","\u5199\u4e86\u5200\u5b50","\u5199\u4e86\u641e\u7b11","\u5199\u4e86r18","\u8e29\u653b"],this.tagMap=new Map,this.tagMap.set("\u9006\u5bb6\u62c9\u8e29\u8a00\u8bba",["[A]\u662f\u5c0f\u5a07\u59bb\uff0c[B]\u662f\u5927\u731b1"]),this.tagMap.set("\u96f7\u6587\u8bc4\u8bba",["\u7d2f\u6b7b\u6211\u4e86"]),this.tagMap.set("\u53d7\u629a\u6170\u88c5\u653b\u7c89",["\u6211\u662f[A]\u7c89\uff0c[B]\u7ed9\u6211\u8d85\u8d85"]),this.loadSetups(),this.words=["\u53a8\u529b","\u540d\u8a89","\u7c89\u4e1d","CP\u70ed\u5ea6"]},init:function(){this.loadSetups(),this.tags=[],this.properties=[50,50,50,50],this.changeProperty(0,0),this.changeProperty(1,0),this.changeProperty(2,0),this.changeProperty(3,0),this.turn=0,this.endTexts=[],this.currNode={title:"",index:-1,properties:[0,0,0,0],require:"",addTag:"",choices:[],content:"\u4f60\u6765\u5230\u4e86\u4e00\u4e2a\u65b0\u5708\uff01",defaultGoto:""},this.currNode=this.events[0],this.renderNode()},next:function(){if(!(this.choices.length>0&&"\u968f\u673a"!=this.currNode.defaultGoto)){if("\u4e0d\u663e\u793a"!=this.currNode.noti&&this.addEvt(this.finalText),this.clearHolder(this.choiceHolder),"1"==this.currNode.defaultGoto)this.currNode=this.events[this.currNode.index+1];else if("\u7ed3\u675f"==this.currNode.defaultGoto)this.end();else if("\u968f\u673a"==this.currNode.defaultGoto){var t=this.currNode.choices[this.getRandomInt(this.currNode.choices.length)],e=this.storage.get(t);e?this.getRandomRequireEvt(e):this.getRandomEvt()}else if(this.currNode.defaultGoto){var i=this.currNode.defaultGoto,s=this.storage.get(i);s?this.getRandomRequireEvt(s):this.getRandomEvt()}else this.turn++,this.getRandomEvt();this.renderNode()}},getRandomRequireEvt:function(t){console.log(t);for(var e=[],i=0;i<t.length;i++){var s=this.events[t[i]];this.match(s.require,s.used,!1)&&e.push(t[i])}var r=this.getRandomInt(e.length);this.currNode=this.events[e[r]],"\u4e00\u6b21\u6027"==this.currNode.noti&&(this.currNode.used=!0)},encode:function(t){return t=t.replace(/\\/g,"%"),t=(t=(t=unescape(t)).replace(/%/g,"\\")).replace(/\\/g,""),console.log(t),t},getRandomEvt:function(){if(this.turn>=30){if(90==this.turn)return void(this.currNode=this.events[7]);if(0==this.getRandomInt(5))return void(this.currNode=this.events[6])}for(var t=[],e=0;e<this.defaultStorage.length;e++){var i=this.events[this.defaultStorage[e]];!i.title&&this.match(i.require,i.used)&&t.push(this.defaultStorage[e])}var s=this.getRandomInt(t.length);this.currNode=this.events[t[s]],"\u91cd\u590d"!=this.currNode.others&&(this.events[t[s]].require="FALSE")},match:function(t,e,i){if(void 0===e&&(e=!1),void 0===i&&(i=!0),!t)return!0;if("TRUE"==t)return!0;if(i){if(!t)return!1;if("FALSE"==t)return!1}else{if(e)return!1;if(!t)return!0;if("FALSE"==t)return!0}for(var s=["<",">","="],r=["\u53a8\u529b","\u540d\u8a89","\u70ed\u5ea6","CP","day"],n=t.split("&"),o=0;o<n.length;o++){for(var h=n[o],c=!1,a=0;a<s.length;a++)if(h.includes(s[a])){var d=h.split(s[a]);if(d.length>=2){var l=r.indexOf(d[0]),u=parseInt(d[1]);4==l?this.turn>=u&&(c=!0):0==a&&this.properties[l]<u?c=!0:1==a&&this.properties[l]>u?c=!0:2==a&&this.properties[l]==u&&(c=!0)}}if(h.length>0&&("!"==h.substring(0,1)?(h=h.substring(1,h.length),0==this.tags.includes(h)&&(c=!0)):this.tags.includes(h)&&(c=!0)),!c)return!1}return console.log(t+" :true"),!0},clearHolder:function(t){for(var e=0;e<t.childrenCount;e++)t.children[e].destroy()},loadSetups:function(){this.events=[];var t=this.setup.json;this.events=t,this.storage=new Map,this.defaultStorage=[];for(var e=0;e<this.events.length;e++){var i=this.events[e].require;this.events[e].title?(i=this.events[e].title,this.storage.has(i)?this.storage.get(i).push(e):this.storage.set(i,[e])):"FALSE"==i||this.defaultStorage.push(e)}var s=this.tagSetup.json;for(e=0;e<s.length;e++)this.tagMap.set(s[e].title,s[e].content)},setButton:function(t,e,i,s,r){var n=new cc.Component.EventHandler;n.target=e,n.component=i,n.handler=s,n.customEventData=r,t.clickEvents.push(n)},replace:function(t){return t=this.strReplaceAll("[A]",this.characters[0],t),t=this.strReplaceAll("[B]",this.characters[1],t),t=this.strReplaceAll("[C]",this.characters[2],t),t=this.strReplaceAll("[D]",this.characters[2],t),t=this.strReplaceAll("[AB]",this.cps[0],t),t=this.strReplaceAll("[AU]",this.author,t),this.strReplaceAll("[CB]",this.cps[1],t)},renderChoices:function(t){if(this.choices=t,console.log(t),!(!t|0==t.length))for(var e=0;e<t.length;e++){var i=cc.instantiate(this.choicePfb);this.choiceHolder.addChild(i),i.setPosition(0,0),i.children[0].getComponent(cc.Label).string=t[e].split("\uff1a")[0],this.setButton(i.getComponent(cc.Button),this.node,"GM","selectChoice",t[e])}},selectChoice:function(t,e){this.choices=null,this.clearHolder(this.choiceHolder),"\u4e0d\u663e\u793a"!=this.currNode.noti&&this.addEvt(this.finalText);var i=this.storage.get(e);if(i)this.getRandomRequireEvt(i);else{var s=e.split("\uff1a");(i=this.storage.get(s[1]))?this.getRandomRequireEvt(i):(console.log("\u9009\u9879\u9519\u8bef\uff1a"+e),this.getRandomEvt())}this.renderNode()},replaceTag:function(t,e){if(this.tagMap.has(t)){var i=this.tagMap.get(t),s=i[this.getRandomInt(i.length)];e=this.strReplaceAll("\u3010"+t+"\u3011",s,e)}return e},renderNode:function(){if(this.currNode||this.getRandomEvt(),"\u6536\u5230\u8bc4\u8bba"==this.currNode.title&&this.tags.includes(this.currNode.require)){var t=this.tags.indexOf(this.currNode.require);this.tags.splice(t,1)}this.turnText.string="\u7b2c"+this.turn+"\u5929",this.finalText=this.currNode.content,this.currNode.others&&(this.finalText=this.replaceTag(this.currNode.others,this.finalText)),this.finalText=this.replace(this.finalText),this.label.string=this.finalText,this.label.string+="\n";for(var e=0;e<this.currNode.properties.length;e++)if(0!=this.currNode.properties[e]){this.changeProperty(e,this.currNode.properties[e]);var i=this.currNode.properties[e];this.label.string+=this.words[e]+" ",this.label.string+=i>0?"+"+i:i,this.label.string+="  "}var s=this.currNode.addTag;if(s)if("!"==s.substring(0,1)){s=s.substring(1,s.length);var r=this.tags.indexOf(s);r>=0&&this.tags.splice(r,1)}else 0==this.tags.includes(s)&&this.tags.push(s);"\u968f\u673a"!=this.currNode.defaultGoto?this.renderChoices(this.currNode.choices):this.choices=[],""==this.currNode.content&&this.next()},changeProperty:function(t,e){this.properties[t]+=e,cc.tween(this.propHolder.children[t].children[0].children[0]).to(.5,{scaleY:this.properties[t]/100}).start()},addEvt:function(t){if(t){this.endTexts.push(t);var e=cc.instantiate(this.pfb);e.children[0].getComponent(cc.Label).string=t,this.holder.addChild(e),e.setPosition(0,0)}}}),cc._RF.pop()},{}],Setup:[function(t,e){"use strict";cc._RF.push(e,"6246bWr9vVKSbjCtXh05oXx","Setup"),cc.Class({extends:cc.Component,properties:{editboxes:[cc.EditBox],manag:cc.Node,cover:cc.Node},open:function(){this.cover.active=!1,this.node.active=!0},confirm:function(){this.init(),this.gm.cps=[this.editboxes[0].string,this.editboxes[3].string],this.gm.characters=[this.editboxes[1].string,this.editboxes[2].string,this.editboxes[4].string],this.gm.author=this.editboxes[5].string,this.node.active=!1,this.gm.init()},init:function(){this.gm=this.manag.getComponent("GM")},start:function(){this.editboxes[0].string="\u5b1b\u9e1f",this.editboxes[1].string="\u7504\u5b1b",this.editboxes[2].string="\u5b89\u9675\u5bb9",this.editboxes[3].string="\u56db\u5b1b",this.editboxes[4].string="\u7709\u5e84",this.editboxes[5].string="\u5c0f\u679d"}}),cc._RF.pop()},{}]},{},["GM","Setup"]);